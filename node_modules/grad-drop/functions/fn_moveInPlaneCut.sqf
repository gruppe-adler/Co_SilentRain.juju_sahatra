#include "..\component.hpp"

params ["_unit", "_delay"];

if (!hasInterface) exitWith {};
if (!isPlayer _unit) exitWith {}; // dont start cut sequence for AI
_unit setUnitFreefallHeight 1000;

// manage fog
[{
	params ["_args", "_handle"];
	_args params ["_delay"];

	if (player getVariable ["GRAD_drop_dropped", false]) exitWith {
		[_handle] call CBA_fnc_removePerFrameHandler;
		10 setfog [0,0,0];

		// make night a bit brighter
		[{
			params ["_args", "_handle"];

			if (sunOrMoon < 0.2) then {
				setAperture 4;
			} else {
				setAperture -1;
				[_handle] call CBA_fnc_removePerFramehandler;
			};
			
		}, 1, []] call CBA_fnc_addPerFrameHandler;
	};
	_delay setfog [0.9,0,0];
}, 0, [_delay]] call CBA_fnc_addPerFrameHandler;

if (!isNil "grad_drop_debug") exitWith {
	systemChat "debug: skipping cut sequence";
};

_delay fadeSound 0;

cutText ["", "BLACK OUT", _delay];
sleep _delay;

addCamShake [2, 400, 0.7];

titleText ["","PLAIN"];
titleFadeOut 12;

[["14/07/1992 - 2:30", 2, 4, 2], ["After four hours flight", 3, 4, 2], ["near the LZ...", 4, 4, 2]] spawn BIS_fnc_EXP_camp_SITREP;

sleep _delay;

_delay fadeSound 1;

"dynamicBlur" ppEffectEnable true;
"dynamicBlur" ppEffectAdjust [6];
"dynamicBlur" ppEffectCommit 0;
"dynamicBlur" ppEffectAdjust [0.0];
"dynamicBlur" ppEffectCommit 5;

titleCut ["", "BLACK IN", _delay];

_unit setUnitFreefallHeight 20;

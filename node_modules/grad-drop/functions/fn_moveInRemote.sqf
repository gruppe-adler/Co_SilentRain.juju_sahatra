#include "..\component.hpp"

params ["_unit","_planeInSky", "_giveParachute"];

if (_giveParachute) then {
    if (isClass (configFile >> "CfgPatches" >> "zade_boc") && isPlayer _unit) then {[_unit] call zade_boc_fnc_actionOnChest};
    removeBackpack _unit;
    _unit addBackpackGlobal "NonSteerable_Parachute_F";
};

_planeInSky hideObject false;
_unit allowDamage false;

[{
    params ["_unit", "_planeInSky"];
    _planeInSky distance _unit < 20
},{
    params ["_unit", "_planeInSky"];
    detach _unit;

    _unit switchMove "AidlPknlMstpSnonWnonDnon_G01";
    _unit disableAI "MOVE";
    _unit disableAI "ANIM";

    if (!isNil "grad_drop_debug") then {
        private _debugMarker = "VR_3DSelector_01_default_F" createVehicleLocal [0,0,0];
        _debugMarker setPos (getPos _unit);
    };

    [_unit] call ace_weaponselect_fnc_putWeaponAway;
}, [_unit, _planeInSky]] call CBA_fnc_waitUntilAndExecute; 
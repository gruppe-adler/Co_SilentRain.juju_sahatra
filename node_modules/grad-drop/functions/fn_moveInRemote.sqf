#include "..\component.hpp"

params ["_unit","_planeInSky", "_giveParachute", "_onSceneCut", "_delay"];

if (!local _unit) exitWith {_this remoteExec ["grad_drop_fnc_moveInRemote",_unit,false]};

if (_giveParachute) then {
    if (isClass (configFile >> "CfgPatches" >> "zade_boc") && isPlayer _unit) then {[_unit] call zade_boc_fnc_actionOnChest};
    removeBackpack _unit;
    _unit addBackpackGlobal "NonSteerable_Parachute_F";
};

if (isPlayer _unit && isNil "grad_drop_debug") then {
    [_unit, _delay+1, _onSceneCut] call grad_drop_fnc_moveInPlaneCut;
};

_planeInSky hideObject false;
_unit allowDamage false;

// private _relDir = _unit getVariable ["grad_drop_relDir", 0];
// _unit setDir (getDir _planeInSky + _relDir + 180);

[{
    detach _this;

    _this switchMove "AidlPknlMstpSnonWnonDnon_G01";
    _this disableAI "MOVE";
    _this disableAI "ANIM";

    if (!isNil "grad_drop_debug") then {
        private _debugMarker = "VR_3DSelector_01_default_F" createVehicleLocal [0,0,0];
        _debugMarker setPos (getPos _this);
    };

    [_this] call ace_weaponselect_fnc_putWeaponAway;
}, _unit, 5] call CBA_fnc_waitAndExecute; 
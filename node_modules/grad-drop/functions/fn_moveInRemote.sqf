#include "..\component.hpp"

params ["_unit","_planeInSky","_relPos","_giveParachute"];

if (!local _unit) exitWith {_this remoteExec ["grad_drop_fnc_moveInRemote",_unit,false]};

if (_giveParachute) then {
    if (isClass (configFile >> "CfgPatches" >> "zade_boc")) then {[_unit] call zade_boc_fnc_actionOnChest};
    removeBackpack _unit;
    _unit addBackpackGlobal "NonSteerable_Parachute_F";
};

_planeInSky hideObject false;
_unit allowDamage false;

// _unit attachTo [_planeInSky, _relPos];
detach _unit;

private _trigger = _planeInSky getVariable ["grad_drop_cargoTrigger", objNull];
private _positionInWorld = (_trigger modelToWorld _relPos);
_unit setPos _positionInWorld;

if (!isNil "grad_drop_debug") then {
    private _debugMarker = "VR_3DSelector_01_default_F" createVehicleLocal [0,0,0];
    _debugMarker setPos _positionInWorld;
};

private _relDir = _unit getVariable ["grad_drop_relDir", 0];
_unit setDir (getDir _planeInSky + _relDir + 180);

_unit switchMove "AidlPknlMstpSnonWnonDnon_G01";
_unit disableAI "MOVE";
_unit disableAI "ANIM";

[_unit] call ace_weaponselect_fnc_putWeaponAway;
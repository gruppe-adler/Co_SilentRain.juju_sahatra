#include "..\component.hpp"

params ["_plane", "_isPlaneInBase"];

private _jm = (createGroup civilian) createUnit ["B_survivor_F", [0,0,0], [], 0, "NONE"];

_jm allowDamage false;
_jm setBehaviour "SAFE";
{_jm disableAI _x} forEach ["MOVE","ANIM","AUTOTARGET"];

[_jm] spawn {
    params ["_jm"];
    sleep 5;
    [_jm] call grad_drop_fnc_removeAllGear;
};



[_jm,"HubBriefing_loop"] call grad_drop_fnc_switchMove;


[{
    params ["_plane","_isPlaneInBase","_jm"];
    _plane distance2d [0,0,0] > 100
},
{
    _this spawn {
        params ["_plane","_isPlaneInBase","_jm"];
        sleep 1;
        if (_isPlaneInBase) then {
            private _y = getDir _jm + 180; private _p = 0; private _r = 0; 
            _jm attachTo [_plane,[ 1.25, -2.5, -4.65]];            
            _jm setVectorDirAndUp [ 
                [sin _y * cos _p, cos _y * cos _p, sin _p], 
                ([[sin _r, -sin _p, cos _r * cos _p], -_y] call BIS_fnc_rotateVector2D)
            ];

        } else {
            _jm attachTo [_plane,[ -1.25, 2.5, -4.9]];
        };
        

        // detach _jm;
        // _jm setPos (_plane modelToWorldVisual [ -1.25, 2.5, -4.9]);
    };
}, [_plane,_isPlaneInBase,_jm]] call CBA_fnc_waitUntilAndExecute;

_jm

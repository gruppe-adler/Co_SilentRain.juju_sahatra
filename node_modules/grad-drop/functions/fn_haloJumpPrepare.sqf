#include "..\component.hpp"

if (!isServer) exitWith {_this remoteExec ["grad_drop_fnc_initHalojump",2,false]};

private _planesPrepared = missionNameSpace getVariable ["GRAD_drop_planesPrepared", []];

// spawn static planes to prepare them in position
{
	_x params ["_planeInBase", "_marker", "_height", "_waitBeforeJump", "_giveParachute", "_onSceneCut", "_onLanding"];

	private _triggerPlaneBase = "EmptyDetector" createVehicle [0,0,0];
	_triggerPlaneBase setTriggerArea [1.5, 5.8, getDir _planeInBase, true, 1.5];
	_triggerPlaneBase setPos (_planeInBase modelToWorld [-0.0581055,3.08965,-3.45892]); // manually reverse engineered offset
	_planeInBase setVariable ["grad_drop_cargoTrigger", _triggerPlaneBase, true];

	if (!isNil "grad_drop_debug") then {
            private _debugMarker = "VR_3DSelector_01_default_F" createVehicleLocal [0,0,0];
            _debugMarker setPos getPos _triggerPlaneBase;
    };

	private _dir = markerDir _marker;
	private _position = getMarkerPos _marker;
	private _planeInSky = [_position, _dir, _height] call grad_drop_fnc_spawnPlane;

	private _triggerPlaneSky = "EmptyDetector" createVehicle [0,0,0];
	_triggerPlaneSky setPos (_planeInSky modelToWorld [0.00439453,-2.99376,-3.50015]); // manually reverse engineered offset
	_triggerPlaneSky setTriggerArea [1.5, 5.8, getDir _triggerPlaneSky, true, 1.5];
	_planeInSky setVariable ["grad_drop_cargoTrigger", _triggerPlaneSky, true];

	if (!isNil "grad_drop_debug") then {
            private _debugMarker = "VR_3DSelector_01_default_F" createVehicleLocal [0,0,0];
            _debugMarker setPos getPos _triggerPlaneSky;
    };

	// store mirror object
	_planeInBase setVariable ["grad_drop_planeInSky", _planeInSky, true];

} forEach _planesPrepared;

INFO_2("%1 planes created for HALO jump.", count _planesPrepared);